2025-08-04 13:03:58,731 - MainThread - sqlmesh.core.config.connection - INFO - Creating new DuckDB adapter for in-memory database (connection.py:483)
2025-08-04 13:04:44,824 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage CreateSnapshotRecordsStage (evaluator.py:125)
2025-08-04 13:04:46,444 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage PhysicalLayerUpdateStage (evaluator.py:125)
2025-08-04 13:04:46,448 - ThreadPoolExecutor-1_0 - sqlmesh.core.snapshot.evaluator - INFO - Listing data objects in schema test_db.sqlmesh__analytics (evaluator.py:361)
2025-08-04 13:04:48,063 - ThreadPoolExecutor-1_0 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 32312fc7907c4c3ea3613bdb0523daee */ SELECT current_catalog (base.py:2260)
2025-08-04 13:04:49,573 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema 'test_db.sqlmesh__analytics' (evaluator.py:1180)
2025-08-04 13:04:51,419 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 32312fc7907c4c3ea3613bdb0523daee */ CREATE SCHEMA IF NOT EXISTS "sqlmesh__analytics" (base.py:2260)
2025-08-04 13:04:53,897 - ThreadPoolExecutor-2_0 - sqlmesh.core.snapshot.evaluator - INFO - Creating table 'test_db.sqlmesh__analytics.analytics__seed_model__749403793' (evaluator.py:1542)
2025-08-04 13:04:53,900 - ThreadPoolExecutor-2_0 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 32312fc7907c4c3ea3613bdb0523daee */ CREATE TABLE IF NOT EXISTS "sqlmesh__analytics"."analytics__seed_model__749403793" ("id" INT, "item_id" INT, "event_date" DATE) (base.py:2260)
2025-08-04 13:04:54,562 - ThreadPoolExecutor-2_0 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 32312fc7907c4c3ea3613bdb0523daee */ SELECT 1 FROM "information_schema"."tables" WHERE "table_name" = 'analytics__seed_model__749403793' AND "table_schema" = 'sqlmesh__analytics' (base.py:2260)
2025-08-04 13:04:54,864 - ThreadPoolExecutor-2_0 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 32312fc7907c4c3ea3613bdb0523daee */ DELETE FROM "sqlmesh__analytics"."analytics__seed_model__749403793" WHERE TRUE (base.py:2260)
2025-08-04 13:04:55,195 - ThreadPoolExecutor-2_0 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: INSERT INTO "sqlmesh__analytics"."analytics__seed_model__749403793" ("id", "item_id", "event_date") SELECT CAST("id" AS INT) AS "id", CAST("item_id" AS INT) AS "item_id", CAST("event_date" AS DATE) AS "event_date" FROM (VALUES "<REDACTED VALUES>") AS "t"("id", "item_id", "event_date") (base.py:2260)
2025-08-04 13:04:57,781 - ThreadPoolExecutor-2_1 - sqlmesh.core.snapshot.evaluator - INFO - Creating table 'test_db.sqlmesh__analytics.analytics__incremental_model__2066530387' (evaluator.py:1542)
2025-08-04 13:04:57,784 - ThreadPoolExecutor-2_1 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 32312fc7907c4c3ea3613bdb0523daee */ CREATE TABLE IF NOT EXISTS "sqlmesh__analytics"."analytics__incremental_model__2066530387" ("id" INT, "item_id" INT, "event_date" DATE) (base.py:2260)
2025-08-04 13:04:58,298 - ThreadPoolExecutor-2_1 - sqlmesh.core.snapshot.evaluator - INFO - Dry running model 'analytics.incremental_model' (evaluator.py:1564)
2025-08-04 13:04:58,300 - ThreadPoolExecutor-2_1 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 32312fc7907c4c3ea3613bdb0523daee */ SELECT "seed_model"."id" AS "id", "seed_model"."item_id" AS "item_id", "seed_model"."event_date" AS "event_date" FROM "test_db"."sqlmesh__analytics"."analytics__seed_model__749403793" AS "seed_model" WHERE ("seed_model"."event_date" <= CAST('1970-01-01' AS DATE) AND "seed_model"."event_date" >= CAST('1970-01-01' AS DATE)) AND FALSE LIMIT 0 (base.py:2260)
2025-08-04 13:04:59,319 - ThreadPoolExecutor-2_1 - sqlmesh.core.snapshot.evaluator - INFO - Creating table 'test_db.sqlmesh__analytics.analytics__full_model__828651046' (evaluator.py:1542)
2025-08-04 13:04:59,322 - ThreadPoolExecutor-2_1 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 32312fc7907c4c3ea3613bdb0523daee */ CREATE TABLE IF NOT EXISTS "sqlmesh__analytics"."analytics__full_model__828651046" ("item_id" INT, "num_orders" BIGINT) (base.py:2260)
2025-08-04 13:04:59,906 - ThreadPoolExecutor-2_1 - sqlmesh.core.snapshot.evaluator - INFO - Dry running model 'analytics.full_model' (evaluator.py:1564)
2025-08-04 13:04:59,909 - ThreadPoolExecutor-2_1 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 32312fc7907c4c3ea3613bdb0523daee */ SELECT "incremental_model"."item_id" AS "item_id", COUNT(DISTINCT "incremental_model"."id") AS "num_orders" FROM "test_db"."sqlmesh__analytics"."analytics__incremental_model__2066530387" AS "incremental_model" WHERE FALSE GROUP BY "incremental_model"."item_id" LIMIT 0 (base.py:2260)
2025-08-04 13:05:00,573 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage BackfillStage (evaluator.py:125)
2025-08-04 13:05:02,240 - ThreadPoolExecutor-3_0 - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-08-03 00:00:00, 2025-08-04 00:00:00) for snapshot SnapshotId<"test_db"."analytics"."seed_model": 3692084038> (facade.py:619)
2025-08-04 13:05:02,242 - ThreadPoolExecutor-3_0 - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"test_db"."analytics"."seed_model": 3692084038> (interval.py:213)
2025-08-04 13:05:02,679 - ThreadPoolExecutor-3_1 - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"test_db"."analytics"."incremental_model": 3429513935> (evaluator.py:648)
2025-08-04 13:05:04,348 - ThreadPoolExecutor-3_1 - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2020-01-01 00:00:00, 2025-08-04 00:00:00) into test_db.sqlmesh__analytics.analytics__incremental_model__2066530387' (evaluator.py:703)
2025-08-04 13:05:04,351 - ThreadPoolExecutor-3_1 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 32312fc7907c4c3ea3613bdb0523daee */ DELETE FROM "sqlmesh__analytics"."analytics__incremental_model__2066530387" WHERE "event_date" BETWEEN CAST('2020-01-01' AS DATE) AND CAST('2025-08-03' AS DATE) (base.py:2260)
2025-08-04 13:05:04,918 - ThreadPoolExecutor-3_1 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 32312fc7907c4c3ea3613bdb0523daee */ INSERT INTO "sqlmesh__analytics"."analytics__incremental_model__2066530387" ("id", "item_id", "event_date") SELECT "id", "item_id", "event_date" FROM (SELECT "seed_model"."id" AS "id", "seed_model"."item_id" AS "item_id", "seed_model"."event_date" AS "event_date" FROM "test_db"."sqlmesh__analytics"."analytics__seed_model__749403793" AS "seed_model" WHERE "seed_model"."event_date" <= CAST('2025-08-03' AS DATE) AND "seed_model"."event_date" >= CAST('2020-01-01' AS DATE)) AS "_subquery" WHERE "event_date" BETWEEN CAST('2020-01-01' AS DATE) AND CAST('2025-08-03' AS DATE) (base.py:2260)
2025-08-04 13:05:07,290 - ThreadPoolExecutor-3_1 - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2020-01-01 00:00:00, 2025-08-04 00:00:00) for snapshot SnapshotId<"test_db"."analytics"."incremental_model": 3429513935> (facade.py:619)
2025-08-04 13:05:07,291 - ThreadPoolExecutor-3_1 - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"test_db"."analytics"."incremental_model": 3429513935> (interval.py:213)
2025-08-04 13:05:07,829 - ThreadPoolExecutor-3_1 - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"test_db"."analytics"."full_model": 588182574> (evaluator.py:648)
2025-08-04 13:05:07,844 - ThreadPoolExecutor-3_1 - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-08-03 00:00:00, 2025-08-04 00:00:00) into test_db.sqlmesh__analytics.analytics__full_model__828651046' (evaluator.py:703)
2025-08-04 13:05:07,848 - ThreadPoolExecutor-3_1 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 32312fc7907c4c3ea3613bdb0523daee */ SELECT 1 FROM "information_schema"."tables" WHERE "table_name" = 'analytics__full_model__828651046' AND "table_schema" = 'sqlmesh__analytics' (base.py:2260)
2025-08-04 13:05:08,366 - ThreadPoolExecutor-3_1 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 32312fc7907c4c3ea3613bdb0523daee */ DELETE FROM "sqlmesh__analytics"."analytics__full_model__828651046" WHERE TRUE (base.py:2260)
2025-08-04 13:05:08,688 - ThreadPoolExecutor-3_1 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 32312fc7907c4c3ea3613bdb0523daee */ INSERT INTO "sqlmesh__analytics"."analytics__full_model__828651046" ("item_id", "num_orders") SELECT "incremental_model"."item_id" AS "item_id", COUNT(DISTINCT "incremental_model"."id") AS "num_orders" FROM "test_db"."sqlmesh__analytics"."analytics__incremental_model__2066530387" AS "incremental_model" GROUP BY "incremental_model"."item_id" (base.py:2260)
2025-08-04 13:05:09,310 - ThreadPoolExecutor-3_1 - sqlmesh.core.snapshot.evaluator - INFO - Auditing snapshot SnapshotId<"test_db"."analytics"."full_model": 588182574> (evaluator.py:553)
2025-08-04 13:05:09,319 - ThreadPoolExecutor-3_1 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 32312fc7907c4c3ea3613bdb0523daee */ SELECT "attname" AS "column_name", "pg_catalog".format_type("atttypid", "atttypmod") AS "data_type" FROM "pg_catalog"."pg_attribute" JOIN "pg_catalog"."pg_class" ON "pg_class"."oid" = "attrelid" JOIN "pg_catalog"."pg_namespace" ON "pg_namespace"."oid" = "relnamespace" WHERE ("attnum" > 0 AND NOT "attisdropped" AND "relname" = 'analytics__full_model__828651046') AND "nspname" = 'sqlmesh__analytics' (base.py:2260)
2025-08-04 13:05:10,188 - ThreadPoolExecutor-3_1 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 32312fc7907c4c3ea3613bdb0523daee */ SELECT COUNT(*) FROM (SELECT * FROM "test_db"."sqlmesh__analytics"."analytics__full_model__828651046" AS "analytics__full_model__828651046" WHERE "item_id" < 0) AS "audit" (base.py:2260)
2025-08-04 13:05:11,804 - ThreadPoolExecutor-3_1 - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-08-03 00:00:00, 2025-08-04 00:00:00) for snapshot SnapshotId<"test_db"."analytics"."full_model": 588182574> (facade.py:619)
2025-08-04 13:05:11,805 - ThreadPoolExecutor-3_1 - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"test_db"."analytics"."full_model": 588182574> (interval.py:213)
2025-08-04 13:05:12,688 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage EnvironmentRecordUpdateStage (evaluator.py:125)
2025-08-04 13:05:13,758 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Promoting environment 'prod' (facade.py:167)
2025-08-04 13:05:15,438 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage UnpauseStage (evaluator.py:125)
2025-08-04 13:05:16,265 - MainThread - sqlmesh.core.state_sync.db.snapshot - INFO - Unpausing snapshot SnapshotId<"test_db"."analytics"."seed_model": 3692084038> (snapshot.py:143)
2025-08-04 13:05:16,274 - MainThread - sqlmesh.core.state_sync.db.snapshot - INFO - Unpausing snapshot SnapshotId<"test_db"."analytics"."full_model": 588182574> (snapshot.py:143)
2025-08-04 13:05:16,277 - MainThread - sqlmesh.core.state_sync.db.snapshot - INFO - Unpausing snapshot SnapshotId<"test_db"."analytics"."incremental_model": 3429513935> (snapshot.py:143)
2025-08-04 13:05:16,909 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage VirtualLayerUpdateStage (evaluator.py:125)
2025-08-04 13:05:16,919 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema 'test_db.analytics' (evaluator.py:1180)
2025-08-04 13:05:16,922 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 32312fc7907c4c3ea3613bdb0523daee */ CREATE SCHEMA IF NOT EXISTS "analytics" (base.py:2260)
2025-08-04 13:05:19,996 - ThreadPoolExecutor-4_0 - sqlmesh.core.snapshot.evaluator - INFO - Updating view 'test_db.analytics.seed_model' to point at table 'test_db.sqlmesh__analytics.analytics__seed_model__749403793' (evaluator.py:1497)
2025-08-04 13:05:20,001 - ThreadPoolExecutor-4_0 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 32312fc7907c4c3ea3613bdb0523daee */ DROP VIEW IF EXISTS "analytics"."seed_model" CASCADE (base.py:2260)
2025-08-04 13:05:20,581 - ThreadPoolExecutor-4_0 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 32312fc7907c4c3ea3613bdb0523daee */ CREATE VIEW "analytics"."seed_model" AS SELECT * FROM "test_db"."sqlmesh__analytics"."analytics__seed_model__749403793" (base.py:2260)
2025-08-04 13:05:22,951 - ThreadPoolExecutor-4_1 - sqlmesh.core.snapshot.evaluator - INFO - Updating view 'test_db.analytics.incremental_model' to point at table 'test_db.sqlmesh__analytics.analytics__incremental_model__2066530387' (evaluator.py:1497)
2025-08-04 13:05:22,953 - ThreadPoolExecutor-4_1 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 32312fc7907c4c3ea3613bdb0523daee */ DROP VIEW IF EXISTS "analytics"."incremental_model" CASCADE (base.py:2260)
2025-08-04 13:05:23,690 - ThreadPoolExecutor-4_1 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 32312fc7907c4c3ea3613bdb0523daee */ CREATE VIEW "analytics"."incremental_model" AS SELECT * FROM "test_db"."sqlmesh__analytics"."analytics__incremental_model__2066530387" (base.py:2260)
2025-08-04 13:05:24,811 - ThreadPoolExecutor-4_1 - sqlmesh.core.snapshot.evaluator - INFO - Updating view 'test_db.analytics.full_model' to point at table 'test_db.sqlmesh__analytics.analytics__full_model__828651046' (evaluator.py:1497)
2025-08-04 13:05:24,813 - ThreadPoolExecutor-4_1 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 32312fc7907c4c3ea3613bdb0523daee */ DROP VIEW IF EXISTS "analytics"."full_model" CASCADE (base.py:2260)
2025-08-04 13:05:25,323 - ThreadPoolExecutor-4_1 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 32312fc7907c4c3ea3613bdb0523daee */ CREATE VIEW "analytics"."full_model" AS SELECT * FROM "test_db"."sqlmesh__analytics"."analytics__full_model__828651046" (base.py:2260)
2025-08-04 13:05:25,870 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage FinalizeEnvironmentStage (evaluator.py:125)
2025-08-04 13:05:26,395 - MainThread - sqlmesh.core.state_sync.db.environment - INFO - Finalizing environment 'prod' (environment.py:139)
2025-08-04 13:05:27,159 - MainThread - root - INFO - Shutting down the event dispatcher (dispatcher.py:159)
